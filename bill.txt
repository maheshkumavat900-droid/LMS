<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Library Bill Receipt</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link href="style.css" rel="stylesheet"></head>
<body>
<div class="bill">
  <div class="d-flex justify-content-between align-items-center"><h3 class="m-0">ðŸ“„ Library Bill Receipt</h3><span class="text-muted">Smart LMS</span></div><hr/>
  <div class="meta mb-3"><div><b>Student:</b> <span id="student"></span></div><div><b>Enrollment No:</b> <span id="enroll"></span></div><div><b>Email:</b> <span id="email"></span></div><div><b>Generated:</b> <span id="gen"></span></div></div>
  <div class="mb-3"><b>Book:</b> <span id="book"></span></div>
  <div class="row g-3"><div class="col-md-4"><div class="p-3 bg-light rounded">Issued On<br><b id="issue"></b></div></div><div class="col-md-4"><div class="p-3 bg-light rounded">Promised Submit (To)<br><b id="to"></b></div></div><div class="col-md-4"><div class="p-3 bg-light rounded">Returned On<br><b id="ret"></b></div></div></div>
  <div class="my-4 p-3 border rounded"><div class="d-flex justify-content-between"><span>Fine per day (after 1-day grace):</span><b>â‚¹<span id="perday"></span></b></div><div class="d-flex justify-content-between"><span>Late days (total):</span><b><span id="late"></span> day(s)</b></div><div class="d-flex justify-content-between"><span>Chargeable days (after grace):</span><b><span id="charge"></span> day(s)</b></div><div class="d-flex justify-content-between"><span>Total amount payable:</span><b>â‚¹<span id="total"></span></b></div></div>
  <p class="text-muted small" id="note"></p>
  <div class="d-flex gap-2 no-print"><button class="btn btn-primary" onclick="window.print()">Print / Save PDF</button><a class="btn btn-outline-secondary" href="javascript:window.close()">Close</a></div>
</div>
<script>
const ISSUE_KEY='lms_issues'; const FINE_PER_DAY=10; const GRACE_DAYS=1;
function qs(k){ return new URLSearchParams(location.search).get(k); } function parseDate(s){ return new Date(s+'T00:00:00'); }
function computeFine(to, ret){ const late = Math.max(0, Math.ceil((parseDate(ret)-parseDate(to))/86400000)); const charge = Math.max(0, late - GRACE_DAYS); return {late, charge, fine: charge*FINE_PER_DAY}; }
(function init(){ const id = Number(qs('issueId')); const list = JSON.parse(localStorage.getItem(ISSUE_KEY)||'[]'); const rec = list.find(x=>x.id===id); if(!rec){ document.body.innerHTML='<div class="bill"><h3>Record not found</h3></div>'; return; } const ret = rec.returnDate || new Date().toISOString().slice(0,10); const f = computeFine(rec.toDate, ret); student.textContent = rec.userName; email.textContent = rec.userEmail; enroll.textContent = rec.enrollment || '-'; book.textContent = rec.bookTitle; issue.textContent = rec.fromDate; to.textContent = rec.toDate; ret.textContent = rec.returnDate ? rec.returnDate : '(Not returned yet)'; perday.textContent = FINE_PER_DAY; late.textContent = f.late; charge.textContent = f.charge; total.textContent = f.fine; gen.textContent = new Date().toLocaleString(); note.textContent = f.fine>0 ? `Returned after the allowed period. 1-day grace applied.` : `Returned within allowed period. No fine.`; })();
</script></body></html>